---
import type { Lang } from '../i18n/translations';
import { t } from '../i18n/translations';

interface Props {
  lang: Lang;
}

const { lang } = Astro.props;

// Language prefix for links
const langPrefix = lang === 'ru' ? '' : `/${lang}`;

// Projects data (will come from Sanity later)
const projects = [
  {
    id: 'camp-klassika',
    title: 'Camp Klassika',
    year: '2019—2024',
    image: '/projects/camp-klassika.jpg',
    hasPage: true,
    description: {
      ru: 'Музыкальная программа для бёрнерских фестивалей Огонёк и Холодок. Концерты под открытым небом, импровизации и творческие встречи в атмосфере сообщества.',
      en: 'Music program for burner festivals Ogonek and Kholodok. Open-air concerts, improvisations and creative gatherings in a community atmosphere.',
      cn: '燃烧者节日Ogonek和Kholodok的音乐节目。露天音乐会、即兴创作和社区氛围中的创意聚会。',
    },
  },
  {
    id: 'lampu-bali',
    title: 'Lampu Bali',
    year: '2024',
    image: '/projects/lampu-bali.jpg',
    hasPage: false,
    description: {
      ru: 'Музыкальная резиденция на Бали. Концерты на закате в рисовых полях, джем-сессии с местными музыкантами и творческие встречи.',
      en: 'Music residency in Bali. Sunset concerts in rice fields, jam sessions with local musicians and creative gatherings.',
      cn: '巴厘岛音乐驻留。稻田日落音乐会，与当地音乐家的即兴演奏和创意聚会。',
    },
  },
  {
    id: 'qatar',
    title: 'Qatar',
    year: '2022',
    image: '/releases/qatar-22.jpg',
    hasPage: false,
    description: {
      ru: 'Выступление в Катаре на площадке Heenat Salma. Специальная программа с участием Дмитрия Скворцова.',
      en: 'Performance in Qatar at Heenat Salma venue. Special program featuring Dmitry Skvortsov.',
      cn: '在卡塔尔Heenat Salma场地的演出。德米特里·斯克沃尔佐夫参与的特别节目。',
    },
  },
  {
    id: 'portugal',
    title: 'Portugal Special',
    year: '2023',
    image: '/hero.jpg',
    hasPage: false,
    description: {
      ru: 'Двойной концерт в Лиссабоне: электроника, неоклассика и минимализм + трибьют Radiohead.',
      en: 'Double concert in Lisbon: electronics, neoclassical and minimalism + Radiohead tribute.',
      cn: '里斯本双重音乐会：电子、新古典和极简主义 + Radiohead致敬。',
    },
  },
];
---

<section id="projects" class="py-24 px-6 bg-surface/30">
  <div class="max-w-6xl mx-auto">
    <h2 class="text-3xl md:text-4xl font-light tracking-wide text-center mb-16">
      {t(lang, 'projects.title')}
    </h2>
    
    <!-- Carousel Container -->
    <div class="relative">
      <!-- Main Slide -->
      <div class="overflow-hidden">
        <div 
          class="flex transition-transform duration-500 ease-out" 
          id="projects-carousel"
          style="transform: translateX(0)"
        >
          {projects.map((project, index) => (
            <div 
              class="w-full flex-shrink-0 px-4"
              data-slide={index}
            >
              <div class="grid md:grid-cols-2 gap-8 items-center">
                <!-- Image -->
                <a 
                  href={project.hasPage ? `${langPrefix}/projects/${project.id}/` : undefined}
                  class:list={[
                    "block aspect-video overflow-hidden group",
                    project.hasPage && "cursor-pointer"
                  ]}
                >
                  <img 
                    src={project.image}
                    alt={project.title}
                    class:list={[
                      "w-full h-full object-cover transition-transform duration-500",
                      project.hasPage && "group-hover:scale-105"
                    ]}
                    loading="lazy"
                  />
                </a>
                
                <!-- Info -->
                <div class="text-center md:text-left">
                  <h3 class="text-2xl md:text-3xl font-light tracking-wide mb-2">
                    {project.hasPage ? (
                      <a 
                        href={`${langPrefix}/projects/${project.id}/`}
                        class="hover:text-white/70 transition-colors"
                      >
                        {project.title}
                      </a>
                    ) : (
                      project.title
                    )}
                  </h3>
                  <p class="text-muted text-sm tracking-wider uppercase mb-6">
                    {project.year}
                  </p>
                  <p class="text-text/70 leading-relaxed mb-6">
                    {project.description[lang]}
                  </p>
                  
                  {project.hasPage && (
                    <a 
                      href={`${langPrefix}/projects/${project.id}/`}
                      class="inline-flex items-center gap-2 text-sm tracking-wider uppercase text-white/70 hover:text-white transition-colors"
                    >
                      {lang === 'ru' ? 'Подробнее' : lang === 'cn' ? '了解更多' : 'Learn more'}
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
                      </svg>
                    </a>
                  )}
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>
      
      <!-- Navigation Arrows -->
      <button 
        class="absolute left-0 top-1/2 -translate-y-1/2 -translate-x-4 md:-translate-x-12 w-12 h-12 flex items-center justify-center text-white/50 hover:text-white transition-colors"
        id="projects-prev"
        aria-label={t(lang, 'projects.prev')}
      >
        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 19l-7-7 7-7"></path>
        </svg>
      </button>
      
      <button 
        class="absolute right-0 top-1/2 -translate-y-1/2 translate-x-4 md:translate-x-12 w-12 h-12 flex items-center justify-center text-white/50 hover:text-white transition-colors"
        id="projects-next"
        aria-label={t(lang, 'projects.next')}
      >
        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 5l7 7-7 7"></path>
        </svg>
      </button>
      
      <!-- Dots Indicator -->
      <div class="flex justify-center gap-3 mt-8">
        {projects.map((_, index) => (
          <button 
            class:list={[
              "project-dot w-2 h-2 rounded-full transition-all duration-300",
              index === 0 ? "bg-white w-6" : "bg-white/30 hover:bg-white/50"
            ]}
            data-dot={index}
            aria-label={`Go to slide ${index + 1}`}
          />
        ))}
      </div>
    </div>
  </div>
</section>

<script>
  const carousel = document.getElementById('projects-carousel');
  const prevBtn = document.getElementById('projects-prev');
  const nextBtn = document.getElementById('projects-next');
  const dots = document.querySelectorAll('.project-dot');
  
  let currentSlide = 0;
  const totalSlides = dots.length;
  
  function goToSlide(index: number) {
    if (index < 0) index = totalSlides - 1;
    if (index >= totalSlides) index = 0;
    
    currentSlide = index;
    
    if (carousel) {
      carousel.style.transform = `translateX(-${currentSlide * 100}%)`;
    }
    
    // Update dots
    dots.forEach((dot, i) => {
      if (i === currentSlide) {
        dot.classList.add('bg-white', 'w-6');
        dot.classList.remove('bg-white/30', 'w-2');
      } else {
        dot.classList.remove('bg-white', 'w-6');
        dot.classList.add('bg-white/30', 'w-2');
      }
    });
  }
  
  prevBtn?.addEventListener('click', () => goToSlide(currentSlide - 1));
  nextBtn?.addEventListener('click', () => goToSlide(currentSlide + 1));
  
  dots.forEach((dot, index) => {
    dot.addEventListener('click', () => goToSlide(index));
  });
  
  // Keyboard navigation
  document.addEventListener('keydown', (e) => {
    const projectsSection = document.getElementById('projects');
    if (!projectsSection) return;
    
    const rect = projectsSection.getBoundingClientRect();
    const isVisible = rect.top < window.innerHeight && rect.bottom > 0;
    
    if (isVisible) {
      if (e.key === 'ArrowLeft') goToSlide(currentSlide - 1);
      if (e.key === 'ArrowRight') goToSlide(currentSlide + 1);
    }
  });
</script>
