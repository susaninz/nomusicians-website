---
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';
import { getReleases, urlFor } from '../../lib/sanity';

const lang = 'ru';

// Получаем релизы из Sanity
const allReleases = await getReleases();

// Хелпер для создания slug
function slugify(text: string): string {
  return text.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)/g, '');
}

// Первый релиз - "главный", остальные - обычные
const featuredRelease = allReleases[0];
const otherReleases = allReleases.slice(1);
---

<Layout title="Релизы — Вариант D (Вертикальный акцент слева)" lang={lang}>
  <Header currentLang={lang} />
  
  <main class="pt-24 pb-16">
    <!-- Демо лейбл -->
    <div class="fixed top-20 right-4 z-50 bg-green-500 text-black px-3 py-1 text-sm font-bold rounded">
      DEMO: Вариант D
    </div>

    <!-- Основной контент - главный слева, остальные справа -->
    <section class="px-6">
      <div class="max-w-7xl mx-auto">
        <div class="grid lg:grid-cols-[1fr_2fr] gap-8 lg:gap-12">
          
          <!-- Главный релиз слева (вертикальный) -->
          {featuredRelease && (
            <div class="lg:sticky lg:top-24 lg:self-start">
              <a 
                href={`/releases/${slugify(featuredRelease.title)}/`}
                class="group block no-underline"
              >
                <!-- Вертикальное фото -->
                <div class="aspect-[3/4] mb-6 overflow-hidden bg-surface">
                  <img 
                    src={featuredRelease.cover ? urlFor(featuredRelease.cover).width(600).height(800).url() : '/og-image.png'} 
                    alt={featuredRelease.title}
                    class="w-full h-full object-cover grayscale group-hover:grayscale-0 transition-all duration-700"
                  />
                </div>
                
                <h1 class="text-3xl md:text-4xl font-light tracking-wide mb-3" style="font-family: var(--font-logo);">
                  {featuredRelease.title}
                </h1>
                
                {featuredRelease.artist && (
                  <p class="text-lg text-muted mb-2">
                    совместно с {featuredRelease.artist}
                  </p>
                )}
                
                <p class="text-muted mb-4">
                  {featuredRelease.year}
                </p>
                
                <div class="flex items-center gap-2 text-white group-hover:text-muted transition-colors">
                  <span>Слушать</span>
                  <svg class="w-4 h-4 transform group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
                  </svg>
                </div>
              </a>
            </div>
          )}

          <!-- Остальные релизы справа (сетка) -->
          <div>
            <div class="grid grid-cols-2 md:grid-cols-3 gap-4 md:gap-6">
              {otherReleases.map((release) => (
                <a 
                  href={`/releases/${slugify(release.title)}/`}
                  class="group block no-underline"
                >
                  <div class="aspect-square mb-3 overflow-hidden bg-surface">
                    <img 
                      src={release.cover ? urlFor(release.cover).width(400).url() : '/og-image.png'} 
                      alt={release.title}
                      class="w-full h-full object-cover grayscale group-hover:grayscale-0 transition-all duration-500"
                    />
                  </div>
                  <h3 class="text-white text-sm md:text-base font-light group-hover:text-muted transition-colors">{release.title}</h3>
                  {release.artist && (
                    <p class="text-muted text-xs md:text-sm">with {release.artist}</p>
                  )}
                  <p class="text-muted text-xs md:text-sm">{release.year}</p>
                </a>
              ))}
            </div>
          </div>
          
        </div>
      </div>
    </section>
  </main>
</Layout>

<style>
  a {
    text-decoration: none !important;
  }
  a:visited {
    color: inherit;
  }
</style>

