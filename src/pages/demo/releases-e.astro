---
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';
import { getReleases, urlFor } from '../../lib/sanity';

const lang = 'ru';

// Получаем релизы из Sanity
const allReleases = await getReleases();

// Хелпер для создания slug
function slugify(text: string): string {
  return text.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)/g, '');
}

// Первый релиз - "главный", остальные - обычные
const featuredRelease = allReleases[0];
const otherReleases = allReleases.slice(1);
---

<Layout title="Релизы — Вариант E (Оверлей на фото)" lang={lang}>
  <Header currentLang={lang} />
  
  <main class="pt-24 pb-16">
    <!-- Демо лейбл -->
    <div class="fixed top-20 right-4 z-50 bg-purple-500 text-white px-3 py-1 text-sm font-bold rounded">
      DEMO: Вариант E
    </div>

    <!-- Главный релиз - Hero с оверлеем -->
    {featuredRelease && (
      <section class="mb-16">
        <a 
          href={`/releases/${slugify(featuredRelease.title)}/`}
          class="group block no-underline relative"
        >
          <!-- Фото на всю ширину -->
          <div class="relative aspect-[21/9] md:aspect-[3/1] overflow-hidden">
            <img 
              src={featuredRelease.cover ? urlFor(featuredRelease.cover).width(1920).height(640).url() : '/og-image.png'} 
              alt={featuredRelease.title}
              class="w-full h-full object-cover grayscale group-hover:grayscale-0 transition-all duration-700"
            />
            
            <!-- Градиент снизу -->
            <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/30 to-transparent"></div>
          </div>
          
          <!-- Текст поверх (внизу) -->
          <div class="absolute bottom-0 left-0 right-0 px-6 pb-8 md:pb-12">
            <div class="max-w-6xl mx-auto">
              <div class="flex flex-col md:flex-row md:items-end md:justify-between gap-4">
                <div>
                  <h1 class="text-3xl md:text-5xl lg:text-6xl font-light tracking-wide mb-2 text-white" style="font-family: var(--font-logo);">
                    {featuredRelease.title}
                  </h1>
                  
                  <div class="flex items-center gap-4 text-white/80">
                    {featuredRelease.artist && (
                      <span>совместно с {featuredRelease.artist}</span>
                    )}
                    <span>{featuredRelease.year}</span>
                  </div>
                </div>
                
                <div class="flex items-center gap-2 text-white group-hover:text-white/70 transition-colors shrink-0">
                  <span class="text-lg">Слушать</span>
                  <svg class="w-5 h-5 transform group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
                  </svg>
                </div>
              </div>
            </div>
          </div>
        </a>
      </section>
    )}

    <!-- Остальные релизы - сетка -->
    {otherReleases.length > 0 && (
      <section class="px-6">
        <div class="max-w-6xl mx-auto">
          <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
            {otherReleases.map((release) => (
              <a 
                href={`/releases/${slugify(release.title)}/`}
                class="group block no-underline"
              >
                <div class="aspect-square mb-3 overflow-hidden bg-surface">
                  <img 
                    src={release.cover ? urlFor(release.cover).width(400).url() : '/og-image.png'} 
                    alt={release.title}
                    class="w-full h-full object-cover grayscale group-hover:grayscale-0 transition-all duration-500"
                  />
                </div>
                <h3 class="text-white font-light group-hover:text-muted transition-colors">{release.title}</h3>
                {release.artist && (
                  <p class="text-muted text-sm">with {release.artist}</p>
                )}
                <p class="text-muted text-sm">{release.year}</p>
              </a>
            ))}
          </div>
        </div>
      </section>
    )}
  </main>
</Layout>

<style>
  a {
    text-decoration: none !important;
  }
  a:visited {
    color: inherit;
  }
</style>

