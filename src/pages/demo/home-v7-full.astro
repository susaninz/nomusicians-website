---
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import { getEventsForHome, type SanityEvent } from '../../lib/sanity';

const lang = 'ru';

const sanityEvents = await getEventsForHome();

// Короткие названия месяцев (не более 3 символов)
function formatDateShort(dateStr: string): string {
  const date = new Date(dateStr);
  const months = ['янв', 'фев', 'мар', 'апр', 'май', 'июн', 'июл', 'авг', 'сен', 'окт', 'ноя', 'дек'];
  const day = date.getDate();
  const month = months[date.getMonth()];
  const year = date.getFullYear();
  
  const currentYear = new Date().getFullYear();
  if (year === currentYear) {
    return `${day} ${month}`;
  }
  return `${day} ${month} ${year}`;
}

const events = sanityEvents.map((e: SanityEvent) => {
  const city = e.city?.[lang] || e.city?.ru || '';
  const venue = e.venue?.[lang] || e.venue?.ru || '';
  const description = e.description?.[lang] || e.description?.ru || '';
  
  const location = (e.eventType === 'concert' && (venue || city)) 
    ? [venue, city].filter(Boolean).join(', ') 
    : '';
  
  return {
    type: e.eventType,
    title: e.title?.[lang] || e.title?.ru || '',
    location,
    description,
    date: formatDateShort(e.date),
    time: e.time || null,
    buttonText: e.buttonText?.[lang] || e.buttonText?.ru || 'Подробнее',
    buttonUrl: e.url || '#',
    isFuture: e.isFuture,
  };
});
---

<Layout title="Демо: Вариант 7 Full — Полное описание" lang={lang}>
  <Header currentLang={lang} />
  
  <main class="pt-24 pb-20">
    <div class="fixed top-20 right-4 z-50 bg-teal-600/80 text-white px-3 py-1 text-xs font-medium rounded">
      ВАРИАНТ 7 FULL: Полное описание
    </div>

    <div class="max-w-4xl mx-auto px-6">
      
      <section class="mb-16">
        <div class="mb-8">
          <h2 class="text-white text-2xl mb-3">Вариант 7 Full: Полное описание</h2>
          <p class="text-muted text-sm mb-2">Дата сверху, кнопка под ней — в одной колонке справа.</p>
          <p class="text-muted text-sm">Описание НЕ обрезается, количество строк может быть разным.</p>
        </div>
        
        <p class="text-muted text-sm tracking-[0.2em] uppercase mb-8 text-center">
          Актуальное
        </p>
        
        <div class="space-y-4">
          {events.map((event) => (
            <a 
              href={event.buttonUrl}
              class={`group flex items-start justify-between py-4 px-6 border ${event.isFuture ? 'border-white/20' : 'border-white/10'} hover:border-white/30 hover:bg-white/5 transition-all no-underline ${!event.isFuture ? 'opacity-60 hover:opacity-100' : ''}`}
            >
              <!-- Колокольчик -->
              <div class="w-8 flex-shrink-0 pt-1">
                {event.isFuture && (
                  <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.64 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"/>
                  </svg>
                )}
              </div>
              
              <!-- Текст -->
              <div class="text-left flex-1 min-w-0 pr-8">
                <p class="text-white font-light">
                  {event.title}
                  {event.location && <span class="text-white/50"> | {event.location}</span>}
                </p>
                {event.description && <p class="text-muted text-sm">{event.description}</p>}
              </div>
              
              <!-- Дата + Кнопка (вертикально) -->
              <div class="flex flex-col items-end gap-1 flex-shrink-0 min-w-[100px]">
                <div class="text-right">
                  <p class="text-white text-sm">{event.date}</p>
                  {event.time && <p class="text-muted text-xs">{event.time}</p>}
                </div>
                <span class="text-white/60 text-xs tracking-wider uppercase whitespace-nowrap group-hover:text-white transition-colors">
                  {event.buttonText} →
                </span>
              </div>
            </a>
          ))}
        </div>
        
        <div class="mt-10 text-center">
          <a href="/events" class="text-muted hover:text-white transition-colors text-sm inline-flex items-center gap-2">
            Все события
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
            </svg>
          </a>
        </div>
      </section>

    </div>
    
    <Footer />
  </main>
</Layout>

<style>
  a {
    text-decoration: none !important;
  }
</style>

