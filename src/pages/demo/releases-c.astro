---
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';
import { getReleases, urlFor } from '../../lib/sanity';

const lang = 'ru';

// Получаем релизы из Sanity
const allReleases = await getReleases();

// Хелпер для создания slug
function slugify(text: string): string {
  return text.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)/g, '');
}

// Первый релиз - "главный", остальные - обычные
const featuredRelease = allReleases[0];
const otherReleases = allReleases.slice(1);
---

<Layout title="Релизы — Вариант C (Сплит + список)" lang={lang}>
  <Header currentLang={lang} />
  
  <main class="pt-24 pb-16">
    <!-- Демо лейбл -->
    <div class="fixed top-20 right-4 z-50 bg-yellow-500 text-black px-3 py-1 text-sm font-bold rounded">
      DEMO: Вариант C
    </div>

    <!-- Главный релиз - Сплит 50/50 -->
    {featuredRelease && (
      <section class="px-6 mb-16">
        <div class="max-w-6xl mx-auto">
          <a 
            href={`/releases/${slugify(featuredRelease.title)}/`}
            class="group block no-underline"
          >
            <div class="grid md:grid-cols-2 gap-8 md:gap-12 items-center">
              <!-- Фото слева -->
              <div class="aspect-square overflow-hidden bg-surface">
                <img 
                  src={featuredRelease.cover ? urlFor(featuredRelease.cover).width(800).url() : '/og-image.png'} 
                  alt={featuredRelease.title}
                  class="w-full h-full object-cover grayscale group-hover:grayscale-0 transition-all duration-700"
                />
              </div>
              
              <!-- Текст справа -->
              <div class="flex flex-col justify-center">
                <h1 class="text-4xl md:text-5xl lg:text-6xl font-light tracking-wide mb-4" style="font-family: var(--font-logo);">
                  {featuredRelease.title}
                </h1>
                
                {featuredRelease.artist && (
                  <p class="text-xl text-muted mb-4">
                    совместно с {featuredRelease.artist}
                  </p>
                )}
                
                <p class="text-muted mb-6">
                  {featuredRelease.year} {featuredRelease.label && `· ${featuredRelease.label}`}
                </p>
                
                <p class="text-lg text-muted/80 mb-8 leading-relaxed">
                  Описание релиза будет здесь. Несколько строк текста о записи, её особенностях и настроении.
                </p>
                
                <div class="flex items-center gap-2 text-white group-hover:text-muted transition-colors">
                  <span class="text-lg">Слушать</span>
                  <svg class="w-5 h-5 transform group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
                  </svg>
                </div>
              </div>
            </div>
          </a>
        </div>
      </section>
    )}

    <!-- Разделитель -->
    <div class="max-w-6xl mx-auto px-6 mb-16">
      <div class="border-t border-white/10"></div>
    </div>

    <!-- Остальные релизы - сетка -->
    {otherReleases.length > 0 && (
      <section class="px-6">
        <div class="max-w-6xl mx-auto">
          <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
            {otherReleases.map((release) => (
              <a 
                href={`/releases/${slugify(release.title)}/`}
                class="group block no-underline"
              >
                <div class="aspect-square mb-3 overflow-hidden bg-surface">
                  <img 
                    src={release.cover ? urlFor(release.cover).width(400).url() : '/og-image.png'} 
                    alt={release.title}
                    class="w-full h-full object-cover grayscale group-hover:grayscale-0 transition-all duration-500"
                  />
                </div>
                <h3 class="text-white font-light group-hover:text-muted transition-colors">{release.title}</h3>
                {release.artist && (
                  <p class="text-muted text-sm">with {release.artist}</p>
                )}
                <p class="text-muted text-sm">{release.year}</p>
              </a>
            ))}
          </div>
        </div>
      </section>
    )}
  </main>
</Layout>

<style>
  a {
    text-decoration: none !important;
  }
  a:visited {
    color: inherit;
  }
</style>

